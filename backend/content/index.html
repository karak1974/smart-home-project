<!DOCTYPE html>
<html lang="en">
<head>
    <title>Smart home lamps</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>
</head>
<body onload="init()">

<div id="cardContainer">
    <h2>Smart home lamps</h2>

    <button onclick="addCard()">DEBUG Add lamp</button>
</div>

<script>
    function init() {
        console.log("Getting lamps form backend")

        const url = "https://localhost:8088/api/getLamps";
        // TODO later add some blackmagic to make it prettier

        var resp = httpReq("GET", url)
        fetch(resp)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                console.log(response.text()); // You can use response.json() for JSON data
            })
            .then(data => {
                document.getElementById("response").textContent = data;
            })
            .catch(error => {
                console.error("Error:", error);
                document.getElementById("response").textContent = "Error occurred. Check the browser console for details.";
            });

    }
    function httpReq(method, url)
    {
        var xhr = new XMLHttpRequest();

        xhr.open(method, url, true);

        xhr.onload = function () {
            if (xhr.status >= 200 && xhr.status < 300) {
                var responseData = xhr.responseText;
                console.log(responseData);
            } else {
                console.error('Request failed with status code: ' + xhr.status);
            }
        };

        xhr.onerror = function () {
            console.error('Network error');
        };
        xhr.send();
    }
    function addCard() {
        // Create a new card div
        const cardDiv = document.createElement("div");
        cardDiv.className = "card";
        cardDiv.style.width = "auto";

        // Create the card body
        const cardBody = document.createElement("div");
        cardBody.className = "card-body";

        // Create the table
        const table = document.createElement("table");
        table.style.width = "100%";

        // Create the rows and cells for the table
        const row1 = table.insertRow(0);
        const cell1 = row1.insertCell(0);
        const cell2 = row1.insertCell(1);

        const row2 = table.insertRow(1);
        const cell3 = row2.insertCell(0);

        var btn = "<label class=\"switch\">\n" +
            "<input type=\"checkbox\">\n" +
            "<span class=\"slider\"></span>\n" +
            "</label>"

        // Create elements for the cells
        cell1.innerHTML = "<h4 class='card-title'>Kitchen</h4>";
        cell2.innerHTML = btn; //"<a href='#' class='btn btn-primary'>ON</a>";
        cell2.rowSpan = 2; // Set rowspan for the second cell
        cell3.innerHTML = "<p class='card-text'>Currently: OFF</p>";

        // Append elements to the card
        cardBody.appendChild(table);
        cardDiv.appendChild(cardBody);

        // Append the card to the container
        document.getElementById("cardContainer").appendChild(cardDiv);
    }
</script>

</body>
</html>
